# 抖音采集配置指南

## 📋 修改说明

项目已从 TikTok 改为抖音采集,主要修改:

1. ✅ `main.py` - 主程序已改为抖音模式
2. ✅ `my_apps.yaml` - 配置文件已添加抖音配置
3. ✅ `flush_device_id.py` - 设备ID刷新脚本已改为抖音
4. ✅ 数据库文件名从 `tiktok_users.db` 改为 `douyin_users.db`
5. ✅ 下载目录从 `Download/tiktok/` 改为 `Download/douyin/`
6. ✅ 调度间隔从1分钟改为5分钟(降低频率避免封禁)
7. ✅ 时区从新加坡改为上海

## 🔧 配置步骤

### 第一步: 获取抖音Cookie

1. **打开抖音网页版**
   - 访问: https://www.douyin.com/
   - 登录你的抖音账号

2. **获取Cookie**
   - 按 `F12` 打开开发者工具
   - 切换到 `Network` (网络) 标签
   - 刷新页面 (F5)
   - 在请求列表中找到任意一个请求
   - 在右侧 `Headers` 中找到 `Cookie`
   - 复制完整的Cookie值

3. **填入配置文件**
   - 打开 `my_apps.yaml`
   - 找到 `douyin` 配置下的 `cookie:` 行
   - 粘贴你复制的Cookie

### 第二步: 修改目标用户URL

在 `main.py` 第72行,修改为你要采集的抖音用户主页URL:

```python
self.MAIN_COMMAND = ['f2', 'dy', '-c', 'my_apps.yaml', '-u', 'https://www.douyin.com/user/你的目标用户ID']
```

**如何获取用户ID:**
1. 访问目标用户的抖音主页
2. 复制浏览器地址栏中的完整URL
3. 例如: `https://www.douyin.com/user/MS4wLjABAAAA_example`

### 第三步: 运行设备ID刷新脚本

```bash
python flush_device_id.py
```

这会自动生成新的设备ID并更新到配置文件中。

### 第四步: 测试采集

手动测试一次采集:

```bash
f2 dy -c my_apps.yaml -u https://www.douyin.com/user/你的目标用户ID -m post
```

如果成功,会在 `Download/douyin/post/` 目录下看到下载的视频。

### 第五步: 启动自动调度

```bash
python main.py
```

程序会每5分钟自动采集一次新视频。

## ⚠️ 重要提示

### Cookie有效期
- 抖音Cookie通常有效期为几天到几周
- 如果采集失败,首先检查Cookie是否过期
- 过期后重新获取Cookie并更新配置

### 采集频率
- 默认设置为5分钟一次
- 建议不要设置太频繁,避免被抖音检测为爬虫
- 如需调整,修改 `main.py` 第73行的 `SCHEDULE_INTERVAL`

### 代理设置
- 抖音在国内可以直接访问,无需代理
- `my_apps.yaml` 中的 `proxies` 保持空即可

### 时间范围
- 程序会采集最近5分钟内发布的视频
- 如需采集历史视频,可以手动运行:
  ```bash
  f2 dy -c my_apps.yaml -u 用户URL -i "2026-01-20 00-00-00|2026-01-21 00-00-00"
  ```

## 🔍 常见问题

### 1. 响应内容为空
**原因**: Cookie失效或被检测
**解决**: 重新获取Cookie,运行 `python flush_device_id.py`

### 2. 找不到用户
**原因**: 用户URL错误
**解决**: 确保URL格式正确,包含完整的 `sec_user_id`

### 3. 下载失败
**原因**: 网络问题或视频已删除
**解决**: 检查网络连接,确认视频是否存在

### 4. 数据库错误
**原因**: 旧的TikTok数据库文件冲突
**解决**: 删除 `tiktok_users.db` 和 `tiktok_videos.db` 文件

## 📊 目录结构

```
video-mover/
├── Download/
│   └── douyin/
│       └── post/
│           └── [用户名]/
│               └── [时间戳]/
│                   └── *.mp4
├── Dedup/
│   └── 去重后的视频
├── Upload/
│   └── videos/
│       └── 待上传的视频
├── logs/
│   └── f2-*.log
├── main.py
├── my_apps.yaml
├── flush_device_id.py
└── douyin_users.db
```

## 🚀 下一步

配置完成后:
1. 运行 `python main.py` 启动调度器
2. 程序会自动采集、去重、上传视频
3. 查看 `logs/` 目录中的日志文件了解运行状态
4. 按 `Ctrl+C` 停止程序

## 💡 优化建议

1. **Cookie池**: 准备多个抖音账号的Cookie轮换使用
2. **降低频率**: 如果被频繁限制,将间隔改为10-15分钟
3. **监控日志**: 定期检查 `app.log` 和 `logs/f2-*.log`
4. **备份数据**: 定期备份数据库文件和下载的视频
